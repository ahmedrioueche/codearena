import{w as $,r as s,c as z,j as t,I as L,x as R,d as H,M,y as f,p as P,L as B,z as A,D as V}from"./index-evChX1jM.js";const D=({problem:w,isCollapsed:o,onToggleCollapse:y})=>{const{getProblemChatAnswer:k}=$(),[u,d]=s.useState([]),[i,p]=s.useState(""),[h,x]=s.useState(!1),[v,j]=s.useState(!1),c=s.useRef(null),{isMobile:m}=z(),[g,N]=s.useState([]);s.useEffect(()=>{const e=()=>{var a;if(window.innerWidth<=768){const n=((a=window.visualViewport)==null?void 0:a.height)||window.innerHeight;j(n<window.innerHeight)}};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),s.useEffect(()=>{c.current&&(c.current.scrollTop=c.current.scrollHeight)},[u]),s.useEffect(()=>{if(!o&&i!==void 0){const e=document.getElementById("problem-chat-input");e&&e.focus()}},[o,i]);const C=e=>{const r=/```(\w+)?\s*([\s\S]*?)```/g,a=[];let n;for(;(n=r.exec(e))!==null;)a.push({language:n[1]||"plaintext",content:n[2].trim()});return a},E=e=>e.replace(/```(\w+)?\s*([\s\S]*?)```/g,"").trim(),I=e=>{let r="";return g.length>0&&(r+=` //Conversation History: ${g.join(" ")}`),r+=` //user input starts now// ${e} /////`,r},b=async()=>{if(i.trim()){d(e=>[...e,{sender:"user",text:i}]),p(""),x(!0);try{const e=I(i),r=await k(w,e),a=V(r),n=C(a),S=E(a);n.length>0?d(l=>[...l,{sender:"ai",text:S,code:n[0]}]):d(l=>[...l,{sender:"ai",text:a}]),N(l=>[...l,`//User: ${i}// //You: ${a}//`])}catch{d(r=>[...r,{sender:"ai",text:"Failed to fetch answer. Please try again."}])}finally{x(!1)}}};return t.jsxs("div",{className:`relative h-full transition-all duration-300 flex flex-col ${o?"w-12":"min-w-[300px] max-w-[400px] w-[30vw]"}`,role:"region","aria-label":"Problem Chat",children:[!m&&t.jsx("div",{className:"absolute right-2 top-3 z-10 flex flex-col gap-2",children:t.jsx(L,{onClick:y,ariaLabel:o?"Expand chat":"Collapse chat",ariaPressed:!1,icon:o?R:H})}),t.jsxs("div",{className:`flex flex-col h-full min-h-[540px] transition-all bg-gray-100 dark:bg-dark-background rounded-lg ${o?"hidden":"block"}`,children:[!m&&t.jsxs("div",{className:"flex items-center gap-2 text-light-foreground dark:text-dark-foreground p-4 border-b border-light-border dark:border-dark-border",children:[t.jsx(M,{size:16,className:"mb-1"}),t.jsx("span",{children:"Chat about Problem"})]}),t.jsxs("div",{ref:c,className:"flex-1 overflow-y-auto scrollbar-hide space-y-4 p-4",children:[u.length===0&&t.jsx("div",{className:"text-center text-gray-500 dark:text-gray-400 py-4",children:"Ask questions about the problem to get started"}),u.map((e,r)=>t.jsx(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},className:`flex ${e.sender==="user"?"justify-end":"justify-start"}`,children:t.jsxs("div",{className:`max-w-[80%] p-3 rounded-lg ${e.sender==="user"?"bg-light-primary dark:bg-dark-primary text-white":"bg-gray-200 dark:bg-gray-700 text-black dark:text-white"} break-words whitespace-pre-wrap overflow-hidden`,children:[e.text&&t.jsx("p",{className:"whitespace-pre-wrap overflow-hidden",children:e.text}),e.code&&t.jsx("div",{className:"mt-2 h-[400px] w-full md:min-w-[400px] min-w-[100px]",children:t.jsx(P,{gameMode:"solo",starterCode:e.code.content,isReadOnly:!0})})]})},r)),h&&t.jsx("div",{className:"flex justify-start",children:t.jsx(f.div,{className:"w-4 h-4 bg-light-primary dark:bg-dark-primary rounded-full",animate:{scale:[1,1.5,1]},transition:{duration:.8,repeat:1/0,ease:"easeInOut"}})})]}),t.jsxs("div",{className:`flex items-center gap-2 p-4 border-t border-light-border dark:border-dark-border ${v?"fixed bottom-0 left-0 right-0 bg-gray-100 dark:bg-gray-800":""}`,children:[t.jsx("input",{id:"problem-chat-input",type:"text",value:i,onChange:e=>p(e.target.value),placeholder:"Ask about the problem...",className:"flex-1 p-2 px-3 rounded-lg border border-transparent focus:border-light-primary focus:dark:border-dark-primary bg-white dark:bg-gray-900 text-black dark:text-white outline-none",onKeyDown:e=>{e.key==="Enter"&&b()}}),t.jsx("button",{onClick:b,disabled:h||!i.trim(),className:"p-2 rounded-lg bg-light-primary dark:bg-dark-primary text-white hover:bg-light-primary/80 dark:hover:bg-dark-primary/80 transition-colors disabled:opacity-50",children:h?t.jsx(B,{className:"animate-spin",size:22}):t.jsx(A,{size:22})})]})]})]})};export{D as default};
